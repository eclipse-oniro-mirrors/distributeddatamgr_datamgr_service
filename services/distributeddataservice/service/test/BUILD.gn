# Copyright (c) 2022 Huawei Device Co., Ltd.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
import("//build/ohos_var.gni")
import("//build/test.gni")
import("//foundation/distributeddatamgr/datamgr_service/datamgr_service.gni")

module_output_path = "datamgr_service/datamgr_service/distributeddatafwk"

###############################################################################
config("module_private_config") {
  visibility = [ ":*" ]

  include_dirs = [
    "//foundation/distributedhardware/device_manager/interfaces/inner_kits/native_cpp/include",
    "${data_service_path}/adapter/include",
    "${data_service_path}/app/src",
    "${data_service_path}/framework/include",
    "${data_service_path}/service/bootstrap/include/",
    "${data_service_path}/service/backup/include/",
    "${data_service_path}/service/cloud/",
    "${data_service_path}/service/config/include/",
    "${data_service_path}/service/common/",
    "${data_service_path}/service/crypto/include",
    "${data_service_path}/service/directory/include/",
    "${data_service_path}/service/data_share/common",
    "${data_service_path}/service/data_share/data",
    "${data_service_path}/service/data_share/dfx",
    "${data_service_path}/service/data_share/strategies",
    "${data_service_path}/service/data_share/subscriber_managers",
    "${data_service_path}/service/data_share",
    "${data_service_path}/service/matrix/include/",
    "${data_service_path}/service/kvdb",
    "${data_service_path}/service/object/include",
    "${data_service_path}/service/permission/include",
    "${data_service_path}/service/rdb/",
    "${data_service_path}/service/test/mock",
    "${dataobject_path}/interfaces/innerkits",
    "${dataobject_path}/frameworks/innerkitsimpl/include",
    "${kv_store_distributeddb_path}/interfaces/include/",
    "${kv_store_distributeddb_path}/include/",
    "${relational_store_path}/interfaces/inner_api/cloud_data/include",
    "${relational_store_path}/interfaces/inner_api/common_type/include",
    "${data_service_path}/adapter/include/communicator",
  ]
  cflags = [ "-Werror" ]
  defines = [
    "TEST_ON_DEVICE",
    "OPENSSL_SUPPRESS_DEPRECATED",
  ]
}

ohos_unittest("CloudDataTest") {
  sanitize = {
    cfi = true
    cfi_cross_dso = true
    debug = false
  }
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/service/backup/src/backup_manager.cpp",
    "${data_service_path}/service/bootstrap/src/bootstrap.cpp",
    "${data_service_path}/service/cloud/cloud_data_translate.cpp",
    "${data_service_path}/service/cloud/cloud_service_impl.cpp",
    "${data_service_path}/service/cloud/cloud_service_stub.cpp",
    "${data_service_path}/service/cloud/cloud_types_util.cpp",
    "${data_service_path}/service/cloud/cloud_value_util.cpp",
    "${data_service_path}/service/cloud/sync_manager.cpp",
    "${data_service_path}/service/cloud/sync_strategies/network_sync_strategy.cpp",
    "${data_service_path}/service/common/common_types_utils.cpp",
    "${data_service_path}/service/common/value_proxy.cpp",
    "${data_service_path}/service/common/xcollie.cpp",
    "${data_service_path}/service/config/src/config_factory.cpp",
    "${data_service_path}/service/config/src/model/app_access_check_config.cpp",
    "${data_service_path}/service/config/src/model/app_id_mapping_config.cpp",
    "${data_service_path}/service/config/src/model/backup_config.cpp",
    "${data_service_path}/service/config/src/model/checker_config.cpp",
    "${data_service_path}/service/config/src/model/cloud_config.cpp",
    "${data_service_path}/service/config/src/model/component_config.cpp",
    "${data_service_path}/service/config/src/model/datashare_config.cpp",
    "${data_service_path}/service/config/src/model/device_sync_app_white_list_config.cpp",
    "${data_service_path}/service/config/src/model/directory_config.cpp",
    "${data_service_path}/service/config/src/model/global_config.cpp",
    "${data_service_path}/service/config/src/model/network_config.cpp",
    "${data_service_path}/service/config/src/model/protocol_config.cpp",
    "${data_service_path}/service/config/src/model/thread_config.cpp",
    "${data_service_path}/service/crypto/src/crypto_manager.cpp",
    "${data_service_path}/service/kvdb/user_delegate.cpp",
    "${data_service_path}/service/matrix/src/device_matrix.cpp",
    "${data_service_path}/service/matrix/src/matrix_event.cpp",
    "${data_service_path}/service/permission/src/permission_validator.cpp",
    "${data_service_path}/service/permission/src/permit_delegate.cpp",
    "${data_service_path}/service/rdb/cache_cursor.cpp",
    "${data_service_path}/service/rdb/rdb_asset_loader.cpp",
    "${data_service_path}/service/rdb/rdb_cloud.cpp",
    "${data_service_path}/service/rdb/rdb_cursor.cpp",
    "${data_service_path}/service/rdb/rdb_general_store.cpp",
    "${data_service_path}/service/rdb/rdb_hiview_adapter.cpp",
    "${data_service_path}/service/rdb/rdb_notifier_proxy.cpp",
    "${data_service_path}/service/rdb/rdb_query.cpp",
    "${data_service_path}/service/rdb/rdb_result_set_impl.cpp",
    "${data_service_path}/service/rdb/rdb_result_set_stub.cpp",
    "${data_service_path}/service/rdb/rdb_schema_config.cpp",
    "${data_service_path}/service/rdb/rdb_service_impl.cpp",
    "${data_service_path}/service/rdb/rdb_service_stub.cpp",
    "${data_service_path}/service/rdb/rdb_watcher.cpp",
    "${data_service_path}/service/test/mock/checker_mock.cpp",
    "cloud_data_test.cpp",
  ]

  configs = [ ":module_private_config" ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "access_token:libaccesstoken_sdk",
    "access_token:libtoken_setproc",
    "access_token:libtokenid_sdk",
    "bundle_framework:appexecfwk_base",
    "bundle_framework:appexecfwk_core",
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gtest_main",
    "hicollie:libhicollie",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "huks:libhukssdk",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
    "netmanager_base:net_conn_manager_if",
    "relational_store:native_rdb",
    "resource_management:global_resmgr",
    "samgr:samgr_proxy",
  ]

  deps = [
    "${data_service_path}/adapter/account:distributeddata_account",
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/adapter/schema_helper:distributeddata_schema_helper",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "mock:distributeddata_mock_static",
  ]

  cflags = [
    "-fno-access-control",  # Ignore Private Member Access Control
  ]

  cflags_cc = cflags
}

ohos_unittest("CloudServiceImplTest") {
  sanitize = {
    cfi = true
    cfi_cross_dso = true
    debug = false
  }
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/service/backup/src/backup_manager.cpp",
    "${data_service_path}/service/bootstrap/src/bootstrap.cpp",
    "${data_service_path}/service/cloud/cloud_data_translate.cpp",
    "${data_service_path}/service/cloud/cloud_service_impl.cpp",
    "${data_service_path}/service/cloud/cloud_service_stub.cpp",
    "${data_service_path}/service/cloud/cloud_types_util.cpp",
    "${data_service_path}/service/cloud/cloud_value_util.cpp",
    "${data_service_path}/service/cloud/sync_manager.cpp",
    "${data_service_path}/service/cloud/sync_strategies/network_sync_strategy.cpp",
    "${data_service_path}/service/common/common_types_utils.cpp",
    "${data_service_path}/service/common/value_proxy.cpp",
    "${data_service_path}/service/common/xcollie.cpp",
    "${data_service_path}/service/config/src/config_factory.cpp",
    "${data_service_path}/service/config/src/model/app_access_check_config.cpp",
    "${data_service_path}/service/config/src/model/app_id_mapping_config.cpp",
    "${data_service_path}/service/config/src/model/backup_config.cpp",
    "${data_service_path}/service/config/src/model/checker_config.cpp",
    "${data_service_path}/service/config/src/model/cloud_config.cpp",
    "${data_service_path}/service/config/src/model/component_config.cpp",
    "${data_service_path}/service/config/src/model/datashare_config.cpp",
    "${data_service_path}/service/config/src/model/device_sync_app_white_list_config.cpp",
    "${data_service_path}/service/config/src/model/directory_config.cpp",
    "${data_service_path}/service/config/src/model/global_config.cpp",
    "${data_service_path}/service/config/src/model/network_config.cpp",
    "${data_service_path}/service/config/src/model/protocol_config.cpp",
    "${data_service_path}/service/config/src/model/thread_config.cpp",
    "${data_service_path}/service/crypto/src/crypto_manager.cpp",
    "${data_service_path}/service/kvdb/user_delegate.cpp",
    "${data_service_path}/service/matrix/src/device_matrix.cpp",
    "${data_service_path}/service/matrix/src/matrix_event.cpp",
    "${data_service_path}/service/permission/src/permission_validator.cpp",
    "${data_service_path}/service/permission/src/permit_delegate.cpp",
    "${data_service_path}/service/rdb/cache_cursor.cpp",
    "${data_service_path}/service/rdb/rdb_asset_loader.cpp",
    "${data_service_path}/service/rdb/rdb_cloud.cpp",
    "${data_service_path}/service/rdb/rdb_cursor.cpp",
    "${data_service_path}/service/rdb/rdb_general_store.cpp",
    "${data_service_path}/service/rdb/rdb_hiview_adapter.cpp",
    "${data_service_path}/service/rdb/rdb_notifier_proxy.cpp",
    "${data_service_path}/service/rdb/rdb_query.cpp",
    "${data_service_path}/service/rdb/rdb_result_set_impl.cpp",
    "${data_service_path}/service/rdb/rdb_result_set_stub.cpp",
    "${data_service_path}/service/rdb/rdb_schema_config.cpp",
    "${data_service_path}/service/rdb/rdb_service_impl.cpp",
    "${data_service_path}/service/rdb/rdb_service_stub.cpp",
    "${data_service_path}/service/rdb/rdb_watcher.cpp",
    "${data_service_path}/service/test/mock/checker_mock.cpp",
    "cloud_service_impl_test.cpp",
  ]

  configs = [ ":module_private_config" ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "access_token:libaccesstoken_sdk",
    "access_token:libtoken_setproc",
    "access_token:libtokenid_sdk",
    "bundle_framework:appexecfwk_base",
    "bundle_framework:appexecfwk_core",
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gtest_main",
    "hicollie:libhicollie",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "huks:libhukssdk",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
    "netmanager_base:net_conn_manager_if",
    "relational_store:native_rdb",
    "resource_management:global_resmgr",
    "samgr:samgr_proxy",
  ]

  deps = [
    "${data_service_path}/adapter/account:distributeddata_account",
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/adapter/schema_helper:distributeddata_schema_helper",
    "../../framework:distributeddatasvcfwk",
    "mock:distributeddata_mock_static",
  ]

  cflags = [
    "-fno-access-control",  # Ignore Private Member Access Control
  ]

  cflags_cc = cflags
}

ohos_unittest("CloudTest") {
  module_out_path = module_output_path
  sources = [ "cloud_test.cpp" ]

  configs = [ ":module_private_config" ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "c_utils:utils",
    "googletest:gtest_main",
    "hilog:libhilog",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
  ]

  deps = [
    "../../framework:distributeddatasvcfwk",
    "../../service:distributeddatasvc",
    "mock:distributeddata_mock_static",
  ]
}

ohos_unittest("ValueProxyServiceTest") {
  module_out_path = module_output_path
  sources = [
    "../common/value_proxy.cpp",
    "value_proxy_test.cpp",
  ]

  include_dirs = [
    "../../../../../relational_store/interfaces/inner_api/rdb/include",
    "${relational_store_path}/interfaces/inner_api/common_type/include",
  ]

  configs = [ ":module_private_config" ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
    "-Wno-multichar",
    "-Wno-c99-designator",
  ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "c_utils:utils",
    "googletest:gtest_main",
    "hilog:libhilog",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
  ]

  deps = [
    "${kv_store_distributeddb_path}:distributeddb",
    "${relational_store_inner_api_path}:native_rdb_static",
    "../../framework:distributeddatasvcfwk",
    "../../service:distributeddatasvc",
  ]
}

ohos_unittest("ConfigFactoryTest") {
  module_out_path = module_output_path
  sources = [ "config_factory_test.cpp" ]

  configs = [ ":module_private_config" ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "c_utils:utils",
    "googletest:gtest_main",
    "hilog:libhilog",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
    "openssl:libcrypto_shared",
  ]

  deps = [
    "//foundation/distributeddatamgr/datamgr_service/services/distributeddataservice/framework:distributeddatasvcfwk",
    "//foundation/distributeddatamgr/datamgr_service/services/distributeddataservice/service:distributeddatasvc",
  ]
}

ohos_unittest("DirectoryManagerTest") {
  module_out_path = module_output_path
  sources = [ "directory_manager_test.cpp" ]

  configs = [ ":module_private_config" ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "c_utils:utils",
    "googletest:gtest_main",
    "hilog:libhilog",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
  ]

  deps = [
    "//foundation/distributeddatamgr/datamgr_service/services/distributeddataservice/framework:distributeddatasvcfwk",
    "//foundation/distributeddatamgr/datamgr_service/services/distributeddataservice/service:distributeddatasvc",
  ]
}

ohos_unittest("CryptoManagerTest") {
  module_out_path = module_output_path
  sources = [ "crypto_manager_test.cpp" ]

  configs = [ ":module_private_config" ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "c_utils:utils",
    "googletest:gtest_main",
    "hilog:libhilog",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
  ]

  deps = [
    "//foundation/distributeddatamgr/datamgr_service/services/distributeddataservice/framework:distributeddatasvcfwk",
    "//foundation/distributeddatamgr/datamgr_service/services/distributeddataservice/service:distributeddatasvc",
  ]
}

ohos_unittest("DeviceMatrixTest") {
  module_out_path = module_output_path
  sources = [
    "device_matrix_test.cpp",
    "mock/checker_mock.cpp",
    "mock/db_change_data_mock.cpp",
    "mock/db_store_mock.cpp",
  ]

  configs = [ ":module_private_config" ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "c_utils:utils",
    "googletest:gtest_main",
    "hilog:libhilog",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
  ]

  deps = [
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
  ]
}

ohos_unittest("KVDBGeneralStoreTest") {
  sanitize = {
    cfi = true
    cfi_cross_dso = true
    debug = false
  }
  module_out_path = module_output_path
  sources = [
    "kvdb_general_store_test.cpp",
    "mock/db_change_data_mock.cpp",
    "mock/db_store_mock.cpp",
    "mock/general_watcher_mock.cpp",
    "mock/kv_store_nb_delegate_mock.cpp",
  ]

  include_dirs = [
    "${data_service_path}/service/common",
    "${data_service_path}/service/rdb",
    "${data_service_path}/service/kvdb",
    "${relational_store_path}/interfaces/innerapi/clouddata/include",
    "${relational_store_path}/interfaces/inner_api/rdb/include",
    "${relational_store_path}/interfaces/inner_api/common_type/include",
  ]

  configs = [ ":module_private_config" ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "c_utils:utils",
    "googletest:gtest_main",
    "hilog:libhilog",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
  ]

  deps = [
    "${data_service_path}/adapter/account:distributeddata_account",
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service/kvdb:distributeddata_kvdb",
  ]
}

ohos_unittest("KVDBGeneralStoreAbnormalTest") {
  module_out_path = module_output_path
  sources = [
    "../common/value_proxy.cpp",
    "../kvdb/kvdb_general_store.cpp",
    "../rdb/rdb_cloud.cpp",
    "../rdb/rdb_query.cpp",
    "kvdb_general_store_abnormal_test.cpp",
    "mock/db_change_data_mock.cpp",
    "mock/db_store_mock.cpp",
    "mock/device_manager_adapter_mock.cpp",
    "mock/general_watcher_mock.cpp",
    "mock/kv_store_nb_delegate_mock.cpp",
  ]

  include_dirs = [
    "${data_service_path}/service/common",
    "${data_service_path}/service/rdb",
    "${data_service_path}/adapter/include",
    "${data_service_path}/app/src",
    "${data_service_path}/framework/include",
    "${data_service_path}/service/bootstrap/include/",
    "${data_service_path}/service/backup/include/",
    "${data_service_path}/service/cloud/",
    "${data_service_path}/service/config/include/",
    "${data_service_path}/service/crypto/include",
    "${data_service_path}/service/directory/include/",
    "${data_service_path}/service/data_share/common",
    "${data_service_path}/service/data_share/data",
    "${data_service_path}/service/data_share/strategies",
    "${data_service_path}/service/data_share/subscriber_managers",
    "${data_service_path}/service/data_share",
    "${data_service_path}/service/matrix/include/",
    "${data_service_path}/service/kvdb",
    "${data_service_path}/service/object/include",
    "${data_service_path}/service/permission/include",
    "${data_service_path}/service/test/mock",
    "${data_service_path}/adapter/include/communicator",
  ]

  configs = []

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gmock_main",
    "googletest:gtest_main",
    "hilog:libhilog",
    "ipc:ipc_core",
    "json:nlohmann_json_static",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
    "relational_store:native_rdb",
  ]

  deps = [
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
  ]
}

ohos_unittest("RdbResultSetImplTest") {
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/service/common/value_proxy.cpp",
    "${data_service_path}/service/rdb/rdb_result_set_impl.cpp",
    "${data_service_path}/service/rdb/rdb_result_set_stub.cpp",
    "mock/cursor_mock.cpp",
    "rdb_result_set_impl_test.cpp",
  ]

  include_dirs = [
    "${data_service_path}/service/rdb",
    "${relational_store_path}/interfaces/inner_api/cloud_data/include",
    "${relational_store_path}/interfaces/inner_api/rdb/include",
    "${relational_store_path}/interfaces/inner_api/common_type/include",
  ]

  configs = [ ":module_private_config" ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
    "-Wno-multichar",
    "-Wno-c99-designator",
  ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "c_utils:utils",
    "googletest:gtest_main",
    "hilog:libhilog",
    "ipc:ipc_core",
    "kv_store:distributeddb",
  ]

  deps = [
    "${data_service_path}/adapter/utils:distributeddata_utils",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${relational_store_inner_api_path}:native_rdb_static",
  ]
}

ohos_unittest("RdbServiceTest") {
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/service/common/value_proxy.cpp",
    "${data_service_path}/service/rdb/cache_cursor.cpp",
    "${data_service_path}/service/rdb/rdb_asset_loader.cpp",
    "${data_service_path}/service/rdb/rdb_cloud.cpp",
    "${data_service_path}/service/rdb/rdb_cursor.cpp",
    "${data_service_path}/service/rdb/rdb_general_store.cpp",
    "${data_service_path}/service/rdb/rdb_notifier_proxy.cpp",
    "${data_service_path}/service/rdb/rdb_query.cpp",
    "${data_service_path}/service/rdb/rdb_result_set_impl.cpp",
    "${data_service_path}/service/rdb/rdb_result_set_stub.cpp",
    "${data_service_path}/service/rdb/rdb_watcher.cpp",
    "cache_cursor_test.cpp",
    "mock/general_watcher_mock.cpp",
    "mock/relational_store_manager_mock.cpp",
    "rdb_asset_loader_test.cpp",
    "rdb_cloud_test.cpp",
    "rdb_cursor_test.cpp",
    "rdb_general_store_test.cpp",
    "rdb_query_test.cpp",
    "rdb_result_set_stub_test.cpp",
  ]

  include_dirs = [
    "${relational_store_path}/interfaces/inner_api/cloud_data/include",
    "${relational_store_path}/interfaces/inner_api/rdb/include",
    "${relational_store_path}/interfaces/inner_api/common_type/include",
  ]

  configs = [ ":module_private_config" ]

  cflags = [
    "-Wno-multichar",
    "-Wno-c99-designator",
    "-fno-access-control",  # Ignore Private Member Access Control
  ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "c_utils:utils",
    "googletest:gtest_main",
    "hilog:libhilog",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
  ]

  deps = [
    "${data_service_path}/adapter/utils:distributeddata_utils",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
    "${relational_store_inner_api_path}:native_rdb_static",
  ]
}

ohos_unittest("RdbServiceImplTest") {
  sanitize = {
    cfi = true
    cfi_cross_dso = true
    debug = false
  }
  module_out_path = module_output_path
  sources = [
    "mock/checker_mock.cpp",
    "mock/db_change_data_mock.cpp",
    "mock/db_store_mock.cpp",
    "rdb_service_impl_test.cpp",
  ]

  include_dirs = [
    "${data_service_path}/adapter/include/communicator",
    "${data_service_path}/framework/include/eventcenter",
    "${data_service_path}/service/test/mock",
  ]

  defines = [
    "TEST_ON_DEVICE",
    "OPENSSL_SUPPRESS_DEPRECATED",
  ]
  cflags = [
    "-Werror",
    "-Dprivate=public",
    "-Dprotected=public",
    "-Wno-multichar",
    "-Wno-c99-designator",
    "-fno-access-control",  # Ignore Private Member Access Control
  ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "access_token:libtokenid_sdk",
    "bundle_framework:appexecfwk_base",
    "bundle_framework:appexecfwk_core",
    "c_utils:utils",
    "data_share:datashare_common",
    "data_share:datashare_consumer",
    "device_manager:devicemanagersdk",
    "dsoftbus:softbus_client",
    "hicollie:libhicollie",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "huks:libhukssdk",
    "ipc:ipc_core",
    "kv_store:datamgr_common",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
    "relational_store:native_rdb",
    "resource_management:global_resmgr",
  ]

  deps = [
    "${data_service_path}/adapter/utils:distributeddata_utils",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
    "${data_service_path}/service/rdb:distributeddata_rdb",
  ]
}

ohos_unittest("ObjectAssetLoaderTest") {
  module_out_path = module_output_path
  sources = [
    "../object/src/object_asset_loader.cpp",
    "../object/src/object_asset_machine.cpp",
    "../object/src/object_snapshot.cpp",
    "object_asset_loader_test.cpp",
  ]

  include_dirs = [
    "${dataobject_path}/frameworks/innerkitsimpl/include/common",
    "${dataobject_path}/interfaces/innerkits",
    "${relational_store_path}/interfaces/inner_api/common_type/include",
  ]

  configs = [ ":module_private_config" ]

  external_deps = [
    "c_utils:utils",
    "dfs_service:cloudsync_asset_kit_inner",
    "dfs_service:distributed_file_daemon_kit_inner",
    "googletest:gtest_main",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "ipc:ipc_core",
    "json:nlohmann_json_static",
    "kv_store:distributeddata_inner",
  ]

  deps = [
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]
}

ohos_unittest("ObjectAssetMachineTest") {
  module_out_path = module_output_path
  sources = [
    "../object/src/object_asset_loader.cpp",
    "../object/src/object_asset_machine.cpp",
    "object_asset_machine_test.cpp",
  ]

  include_dirs = [
    "${dataobject_path}/frameworks/innerkitsimpl/include/common",
    "${dataobject_path}/interfaces/innerkits",
    "${relational_store_path}/interfaces/inner_api/common_type/include",
  ]

  configs = [ ":module_private_config" ]

  external_deps = [
    "c_utils:utils",
    "dfs_service:cloudsync_asset_kit_inner",
    "dfs_service:distributed_file_daemon_kit_inner",
    "googletest:gtest_main",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "ipc:ipc_core",
    "json:nlohmann_json_static",
    "kv_store:distributeddata_inner",
  ]

  deps = [
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
  ]
}

ohos_unittest("ObjectDmsHandlerTest") {
  sanitize = {
    cfi = true
    cfi_cross_dso = true
    debug = false
  }
  module_out_path = module_output_path
  sources = [
    "../object/src/object_dms_handler.cpp",
    "object_dms_handler_test.cpp",
  ]

  include_dirs = []

  configs = [ ":module_private_config" ]

  external_deps = [
    "c_utils:utils",
    "dmsfwk:distributed_sdk",
    "googletest:gtest_main",
    "hilog:libhilog",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
  ]

  deps = [
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/framework:distributeddatasvcfwk",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]
}

ohos_unittest("ObjectManagerTest") {
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/app/src/kvstore_meta_manager.cpp",
    "${data_service_path}/service/common/common_types_utils.cpp",
    "${data_service_path}/service/common/value_proxy.cpp",
    "../object/src/object_asset_loader.cpp",
    "../object/src/object_asset_machine.cpp",
    "../object/src/object_callback_proxy.cpp",
    "../object/src/object_data_listener.cpp",
    "../object/src/object_dms_handler.cpp",
    "../object/src/object_manager.cpp",
    "../object/src/object_service_impl.cpp",
    "../object/src/object_service_stub.cpp",
    "../object/src/object_snapshot.cpp",
    "../object/src/object_types_utils.cpp",
    "mock/device_manager_adapter_mock.cpp",
    "mock/kv_store_nb_delegate_mock.cpp",
    "object_manager_test.cpp",
    "object_service_impl_test.cpp",
    "object_service_stub_test.cpp",
  ]

  include_dirs = [
    "${dataobject_path}/frameworks/innerkitsimpl/include",
    "${data_service_path}/app/src",
    "${data_service_path}/service/common",
    "${dataobject_path}/frameworks/innerkitsimpl/include/common",
    "${dataobject_path}/interfaces/innerkits",
    "${data_service_path}/adapter/include/utils",
    "${data_service_path}/service/test/mock",
  ]

  configs = [ ":module_private_config" ]

  external_deps = [
    "access_token:libaccesstoken_sdk",
    "access_token:libtoken_setproc",
    "access_token:libtokenid_sdk",
    "c_utils:utils",
    "data_object:distributeddataobject_impl",
    "dataclassification:data_transit_mgr",
    "dfs_service:cloudsync_asset_kit_inner",
    "dfs_service:distributed_file_daemon_kit_inner",
    "dmsfwk:distributed_sdk",
    "googletest:gmock_main",
    "googletest:gtest_main",
    "googletest:gtest_main",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "ipc:ipc_core",
    "json:nlohmann_json_static",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddata_mgr",
    "kv_store:distributeddb",
    "relational_store:native_rdb",
  ]

  deps = [
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]
}

ohos_unittest("ObjectSnapshotTest") {
  module_out_path = module_output_path
  sources = [
    "../object/src/object_asset_loader.cpp",
    "../object/src/object_asset_machine.cpp",
    "../object/src/object_snapshot.cpp",
    "object_snapshot_test.cpp",
  ]

  include_dirs = [
    "${dataobject_path}/frameworks/innerkitsimpl/include/common",
    "${dataobject_path}/interfaces/innerkits",
    "${relational_store_path}/interfaces/inner_api/common_type/include",
  ]

  configs = [ ":module_private_config" ]

  external_deps = [
    "c_utils:utils",
    "dfs_service:cloudsync_asset_kit_inner",
    "dfs_service:distributed_file_daemon_kit_inner",
    "googletest:gtest_main",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "ipc:ipc_core",
    "json:nlohmann_json_static",
    "kv_store:distributeddata_inner",
  ]

  deps = [
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
  ]
}

ohos_unittest("MetaDataTest") {
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/app/src/kvstore_meta_manager.cpp",
    "meta_data_test.cpp",
  ]

  sanitize = {
    cfi = true
    cfi_cross_dso = true
    debug = false
  }

  include_dirs = [
    "${data_service_path}/app/src",
    "${data_service_path}/service/kvdb",
    "${data_service_path}/adapter/include/account",
    "${kv_store_path}/frameworks/innerkitsimpl/kvdb/include",
    "${kv_store_path}/frameworks/innerkitsimpl/distributeddatafwk/include",
    "${kv_store_path}/frameworks/innerkitsimpl/distributeddatasvc/include",
    "${data_service_path}/adapter/include/communicator",
  ]

  configs = [ ":module_private_config" ]

  external_deps = [
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "access_token:libtoken_setproc",
    "c_utils:utils",
    "dataclassification:data_transit_mgr",
    "googletest:gtest_main",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "ipc:ipc_core",
    "json:nlohmann_json_static",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
  ]

  deps = [
    "${data_service_path}/adapter/account:distributeddata_account",
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service/kvdb:distributeddata_kvdb",
  ]
}

ohos_unittest("UdmfRunTimeStoreTest") {
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/app/src/kvstore_meta_manager.cpp",
    "udmf_run_time_store_test.cpp",
  ]

  include_dirs = [
    "${data_service_path}/adapter/include/account",
    "${data_service_path}/adapter/include/communicator",
    "${data_service_path}/app/src",
    "${data_service_path}/service/kvdb",
    "${data_service_path}/service/udmf",
    "${data_service_path}/service/udmf/store",
    "${data_service_path}/service/udmf/preprocess",
    "${kv_store_path}/frameworks/innerkitsimpl/distributeddatafwk/include",
    "${kv_store_path}/frameworks/innerkitsimpl/distributeddatasvc/include",
    "${kv_store_path}/frameworks/innerkitsimpl/kvdb/include",
  ]

  configs = [ ":module_private_config" ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "access_token:libtoken_setproc",
    "bundle_framework:appexecfwk_base",
    "bundle_framework:appexecfwk_core",
    "c_utils:utils",
    "dataclassification:data_transit_mgr",
    "dsoftbus:softbus_client",
    "googletest:gtest_main",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "image_framework:image",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
    "openssl:libcrypto_shared",
    "samgr:samgr_proxy",
    "udmf:udmf_client",
  ]

  deps = [
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
    "${data_service_path}/service/udmf:udmf_server",
  ]

  defines = [
    "private=public",
    "protected=public",
  ]
}

ohos_unittest("DataShareServiceImplTest") {
  sanitize = {
    cfi = true
    cfi_cross_dso = true
    debug = false
  }
  module_out_path = module_output_path

  include_dirs = [
    "${data_service_path}/service/config/include",
    "${datashare_path}/frameworks/native/common/include",
    "${datashare_path}/interfaces/inner_api/common/include",
    "${datashare_path}/interfaces/inner_api/consumer/include",
    "//third_party/json/single_include",
  ]

  sources = [
    "${data_service_path}/service/common/xcollie.cpp",
    "${data_service_path}/service/crypto/src/crypto_manager.cpp",
    "${data_service_path}/service/data_share/common/app_connect_manager.cpp",
    "${data_service_path}/service/data_share/common/bundle_mgr_proxy.cpp",
    "${data_service_path}/service/data_share/common/common_utils.cpp",
    "${data_service_path}/service/data_share/common/db_delegate.cpp",
    "${data_service_path}/service/data_share/common/div_strategy.cpp",
    "${data_service_path}/service/data_share/common/extension_ability_manager.cpp",
    "${data_service_path}/service/data_share/common/extension_connect_adaptor.cpp",
    "${data_service_path}/service/data_share/common/extension_mgr_proxy.cpp",
    "${data_service_path}/service/data_share/common/kv_delegate.cpp",
    "${data_service_path}/service/data_share/common/rdb_delegate.cpp",
    "${data_service_path}/service/data_share/common/scheduler_manager.cpp",
    "${data_service_path}/service/data_share/common/seq_strategy.cpp",
    "${data_service_path}/service/data_share/common/uri_utils.cpp",
    "${data_service_path}/service/data_share/data/published_data.cpp",
    "${data_service_path}/service/data_share/data/resultset_json_formatter.cpp",
    "${data_service_path}/service/data_share/data/template_data.cpp",
    "${data_service_path}/service/data_share/data_provider_config.cpp",
    "${data_service_path}/service/data_share/data_share_db_config.cpp",
    "${data_service_path}/service/data_share/data_share_obs_proxy.cpp",
    "${data_service_path}/service/data_share/data_share_profile_config.cpp",
    "${data_service_path}/service/data_share/data_share_service_impl.cpp",
    "${data_service_path}/service/data_share/data_share_service_stub.cpp",
    "${data_service_path}/service/data_share/data_share_silent_config.cpp",
    "${data_service_path}/service/data_share/data_share_types_util.cpp",
    "${data_service_path}/service/data_share/dfx/hiview_adapter.cpp",
    "${data_service_path}/service/data_share/dfx/hiview_fault_adapter.cpp",
    "${data_service_path}/service/data_share/strategies/data_proxy/load_config_from_data_proxy_node_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/data_share/load_config_from_data_share_bundle_info_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/general/check_is_data_proxy_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/general/check_is_single_app_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/general/cross_permission_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/general/load_config_common_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/general/load_config_data_info_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/general/load_config_from_bundle_info_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/general/permission_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/get_data_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/publish_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/rdb_notify_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/subscribe_strategy.cpp",
    "${data_service_path}/service/data_share/strategies/template_strategy.cpp",
    "${data_service_path}/service/data_share/subscriber_managers/published_data_subscriber_manager.cpp",
    "${data_service_path}/service/data_share/subscriber_managers/rdb_subscriber_manager.cpp",
    "${data_service_path}/service/data_share/sys_event_subscriber.cpp",
    "${data_service_path}/service/kvdb/user_delegate.cpp",
    "${data_service_path}/service/permission/src/permission_validator.cpp",
    "${data_service_path}/service/permission/src/permit_delegate.cpp",
    "data_share_common_test.cpp",
    "data_share_obs_proxy_test.cpp",
    "data_share_profile_config_test.cpp",
    "data_share_service_impl_test.cpp",
    "data_share_service_stub_test.cpp",
    "data_share_subscriber_managers_test.cpp",
    "data_share_types_util_test.cpp",
    "kv_dalegate_test.cpp",
  ]

  configs = [ ":module_private_config" ]

  cflags = [
    "-g",
    "-O0",
    "-Wno-unused-variable",
    "-fno-omit-frame-pointer",
    "-Wno-multichar",
    "-Wno-c99-designator",
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "ability_base:zuri",
    "ability_runtime:dataobs_manager",
    "ability_runtime:extension_manager",
    "ability_runtime:wantagent_innerkits",
    "access_token:libaccesstoken_sdk",
    "access_token:libtoken_setproc",
    "access_token:libtokenid_sdk",
    "bundle_framework:appexecfwk_base",
    "bundle_framework:appexecfwk_core",
    "c_utils:utils",
    "common_event_service:cesfwk_innerkits",
    "data_share:datashare_common",
    "device_manager:devicemanagersdk",
    "googletest:gtest_main",
    "hicollie:libhicollie",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "huks:libhukssdk",
    "init:libbegetutil",
    "ipc:ipc_core",
    "json:nlohmann_json_static",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
    "kv_store:distributeddb",
    "qos_manager:concurrent_task_client",
    "qos_manager:qos",
    "relational_store:native_rdb",
    "relational_store:rdb_data_share_adapter",
    "resource_management:global_resmgr",
    "samgr:samgr_proxy",
    "time_service:time_client",
  ]

  deps = [
    "${data_service_path}/adapter/utils:distributeddata_utils",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
  ]
}

ohos_unittest("KvdbServiceImplTest") {
  module_out_path = module_output_path
  sanitize = {
    cfi = true
    cfi_cross_dso = true
    debug = false
    blocklist = "${datamgr_service_path}/cfi_blocklist.txt"
  }
  sources = [
    "${data_service_path}/app/src/kvstore_meta_manager.cpp",
    "kvdb_service_impl_test.cpp",
    "kvdb_service_stub_unittest.cpp",
    "kvdb_service_test.cpp",
    "mock/access_token_mock.cpp",
    "mock/checker_mock.cpp",
    "mock/meta_data_manager_mock.cpp",
  ]

  include_dirs = [
    "${data_service_path}/app/src",
    "${data_service_path}/service/kvdb",
    "${data_service_path}/adapter/include/account",
    "${data_service_path}/framework/include",
    "${data_service_path}/framework/include/cloud",
    "${data_service_path}/framework/include/eventcenter",
    "${data_service_path}/service/test/mock",
    "${kv_store_path}/frameworks/innerkitsimpl/kvdb/include",
    "${kv_store_path}/frameworks/innerkitsimpl/distributeddatafwk/include",
    "${kv_store_path}/frameworks/innerkitsimpl/distributeddatasvc/include",
    "${data_service_path}/adapter/include/communicator",
  ]

  configs = [ ":module_private_config" ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  external_deps = [
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "access_token:libtoken_setproc",
    "c_utils:utils",
    "dataclassification:data_transit_mgr",
    "device_auth:deviceauth_sdk",
    "googletest:gmock_main",
    "googletest:gtest_main",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
    "relational_store:native_rdb",
  ]

  deps = [
    "${data_service_path}/adapter/account:distributeddata_account",
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service/kvdb:distributeddata_kvdb",
    "mock:distributeddata_mock_static",
  ]
}

ohos_unittest("DumpHelperTest") {
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/service/dumper/src/dump_helper.cpp",
    "dump_helper_test.cpp",
  ]

  include_dirs = [ "${data_service_path}/service/dumper/include" ]

  configs = [ ":module_private_config" ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  external_deps = [
    "c_utils:utils",
    "googletest:gtest_main",
    "hilog:libhilog",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
    "relational_store:native_rdb",
  ]

  deps = [
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
  ]
}

ohos_unittest("UdmfServiceImplTest") {
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/framework/feature/feature_system.cpp",
    "udmf_service_impl_test.cpp",
  ]

  include_dirs = [
    "${data_service_path}/service/udmf/store",
    "${data_service_path}/service/udmf",
    "${data_service_path}/framework/include",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  deps = [
    "${data_service_path}/service:distributeddatasvc",
    "${data_service_path}/service/udmf:udmf_server",
  ]

  external_deps = [
    "ability_runtime:uri_permission_mgr",
    "access_token:libaccesstoken_sdk",
    "app_file_service:remote_file_share_native",
    "bundle_framework:appexecfwk_base",
    "bundle_framework:appexecfwk_core",
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gtest_main",
    "hilog:libhilog",
    "json:nlohmann_json_static",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
    "relational_store:native_rdb",
    "samgr:samgr_proxy",
    "udmf:udmf_client",
  ]
}

ohos_unittest("UdmfServiceStubTest") {
  module_out_path = module_output_path
  sources = [ "udmf_service_stub_test.cpp" ]

  include_dirs = [
    "${data_service_path}/service/udmf/store",
    "${data_service_path}/service/udmf",
    "${data_service_path}/framework/include",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  deps = [
    "${data_service_path}/service:distributeddatasvc",
    "${data_service_path}/service/udmf:udmf_server",
  ]

  external_deps = [
    "ability_runtime:uri_permission_mgr",
    "access_token:libaccesstoken_sdk",
    "app_file_service:remote_file_share_native",
    "bundle_framework:appexecfwk_base",
    "bundle_framework:appexecfwk_core",
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gtest_main",
    "hilog:libhilog",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
    "relational_store:native_rdb",
    "samgr:samgr_proxy",
    "udmf:udmf_client",
  ]
}

ohos_unittest("UdmfServiceStubMockTest") {
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/framework/account/account_delegate.cpp",
    "${data_service_path}/framework/checker/checker_manager.cpp",
    "${data_service_path}/framework/dfx/reporter.cpp",
    "${data_service_path}/framework/directory/directory_manager.cpp",
    "${data_service_path}/framework/feature/feature_system.cpp",
    "${data_service_path}/framework/metadata/appid_meta_data.cpp",
    "${data_service_path}/framework/metadata/auto_launch_meta_data.cpp",
    "${data_service_path}/framework/metadata/capability_range.cpp",
    "${data_service_path}/framework/metadata/meta_data_manager.cpp",
    "${data_service_path}/framework/metadata/secret_key_meta_data.cpp",
    "${data_service_path}/framework/metadata/store_debug_info.cpp",
    "${data_service_path}/framework/metadata/store_meta_data.cpp",
    "${data_service_path}/framework/metadata/store_meta_data_local.cpp",
    "${data_service_path}/framework/metadata/strategy_meta_data.cpp",
    "${data_service_path}/framework/serializable/serializable.cpp",
    "${data_service_path}/framework/utils/anonymous.cpp",
    "${data_service_path}/framework/utils/constant.cpp",
    "${data_service_path}/framework/utils/corrupt_reporter.cpp",
    "${data_service_path}/framework/utils/crypto.cpp",
    "${data_service_path}/service/udmf/lifecycle/lifecycle_manager.cpp",
    "${data_service_path}/service/udmf/lifecycle/lifecycle_policy.cpp",
    "${data_service_path}/service/udmf/permission/checker_manager.cpp",
    "${data_service_path}/service/udmf/permission/uri_permission_manager.cpp",
    "${data_service_path}/service/udmf/preprocess/data_handler.cpp",
    "${data_service_path}/service/udmf/preprocess/preprocess_utils.cpp",
    "${data_service_path}/service/udmf/store/runtime_store.cpp",
    "${data_service_path}/service/udmf/store/store_account_observer.cpp",
    "${data_service_path}/service/udmf/store/store_cache.cpp",
    "${data_service_path}/service/udmf/udmf_service_impl.cpp",
    "${data_service_path}/service/udmf/udmf_service_stub.cpp",
    "udmf_service_stub_mock_test.cpp",
  ]

  include_dirs = [
    "${data_service_path}/service/udmf/store",
    "${data_service_path}/service/udmf",
    "${data_service_path}/framework/include",
    "${data_service_path}/service/test/mock",
    "${data_service_path}/service/udmf/permission",
    "${data_service_path}/framework/include/dfx",
    "${data_service_path}/service/udmf/preprocess",
    "${data_service_path}/adapter/include/communicator",
    "${data_service_path}/framework/include/account",
    "${data_service_path}/service/udmf/store",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  deps = [ "${data_service_path}/service:distributeddatasvc" ]

  external_deps = [
    "ability_base:zuri",
    "ability_runtime:uri_permission_mgr",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "access_token:libtoken_setproc",
    "access_token:libtokenid_sdk",
    "app_file_service:remote_file_share_native",
    "bundle_framework:appexecfwk_base",
    "bundle_framework:appexecfwk_core",
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gtest_main",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "hitrace:hitrace_meter",
    "hitrace:libhitracechain",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
    "relational_store:native_rdb",
    "samgr:samgr_proxy",
    "udmf:udmf_client",
  ]
}

ohos_unittest("UdmfPreProcessUtilsTest") {
  module_out_path = module_output_path
  sources = [ "udmf_preprocess_utils_test.cpp" ]

  include_dirs = [
    "${data_service_path}/service/udmf/permission",
    "${data_service_path}/service/udmf/preprocess",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  deps = [
    "${data_service_path}/service:distributeddatasvc",
    "${data_service_path}/service/udmf:udmf_server",
  ]

  external_deps = [
    "ability_runtime:uri_permission_mgr",
    "access_token:libaccesstoken_sdk",
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gtest_main",
    "hitrace:hitrace_meter",
    "hitrace:libhitracechain",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
    "relational_store:native_rdb",
    "udmf:udmf_client",
  ]
}

ohos_unittest("UdmfPreProcessUtilsMockTest") {
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/service/test/mock/access_token_mock.cpp",
    "${data_service_path}/service/udmf/preprocess/preprocess_utils.cpp",
    "udmf_preprocess_utils_mock_test.cpp",
  ]

  include_dirs = [
    "${data_service_path}/service/udmf/preprocess",
    "${data_service_path}/service/test/mock",
    "${data_service_path}/service/udmf/store",
    "${data_service_path}/framework/include/account",
    "${data_service_path}/adapter/include/communicator",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  deps = [
    "${data_service_path}/service:distributeddatasvc",
    "mock:distributeddata_mock_static",
  ]

  external_deps = [
    "ability_runtime:uri_permission_mgr",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "access_token:libtoken_setproc",
    "access_token:libtokenid_sdk",
    "app_file_service:remote_file_share_native",
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gmock_main",
    "googletest:gtest_main",
    "hisysevent:libhisysevent",
    "hitrace:hitrace_meter",
    "hitrace:libhitracechain",
    "udmf:udmf_client",
  ]
}

ohos_unittest("UdmfCheckerManagerTest") {
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/service/udmf/permission/checker_manager.cpp",
    "udmf_checker_manager_test.cpp",
  ]

  include_dirs = [
    "${data_service_path}/adapter/include/account",
    "${data_service_path}/adapter/include/communicator",
    "${data_service_path}/app/src",
    "${data_service_path}/service/kvdb",
    "${data_service_path}/service/udmf",
    "${data_service_path}/service/udmf/lifecycle",
    "${data_service_path}/service/udmf/permission",
    "${data_service_path}/service/udmf/store",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  deps = [
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
  ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "ability_runtime:uri_permission_mgr",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "access_token:libtoken_setproc",
    "app_file_service:fileuri_native",
    "app_file_service:remote_file_share_native",
    "bundle_framework:appexecfwk_core",
    "c_utils:utils",
    "dataclassification:data_transit_mgr",
    "dsoftbus:softbus_client",
    "googletest:gtest_main",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "image_framework:image",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
    "openssl:libcrypto_shared",
    "udmf:udmf_client",
    "udmf:utd_client",
  ]
}

ohos_unittest("PermissionValidatorTest") {
  module_out_path = module_output_path

  include_dirs = [
    "${data_service_path}/service/permission/include",
    "${data_service_path}/framework/include",
  ]

  sources = [
    "${data_service_path}/service/permission/src/permission_validator.cpp",
    "permission_validator_test.cpp",
  ]

  deps = [
    "${data_service_path}/adapter/utils:distributeddata_utils",
    "${data_service_path}/framework:distributeddatasvcfwk",
  ]

  external_deps = [
    "access_token:libaccesstoken_sdk",
    "c_utils:utils",
    "googletest:gtest_main",
    "hilog:libhilog",
    "kv_store:distributeddata_inner",
  ]
  defines = [ "OPENSSL_SUPPRESS_DEPRECATED" ]
}

ohos_unittest("PermissionValidatorMockTest") {
  module_out_path = module_output_path

  include_dirs = [
    "${data_service_path}/service/permission/include",
    "${data_service_path}/service/test/mock",
  ]

  sources = [
    "${data_service_path}/service/permission/src/permission_validator.cpp",
    "mock/access_token_mock.cpp",
    "permission_validator_mock_test.cpp",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  deps = [
    "${data_service_path}/adapter/utils:distributeddata_utils",
    "${data_service_path}/framework:distributeddatasvcfwk",
  ]

  external_deps = [
    "access_token:libaccesstoken_sdk",
    "c_utils:utils",
    "googletest:gmock_main",
    "googletest:gtest_main",
    "hilog:libhilog",
    "kv_store:distributeddata_inner",
  ]
  defines = [ "OPENSSL_SUPPRESS_DEPRECATED" ]
}

ohos_unittest("PermitDelegateMockTest") {
  module_out_path = module_output_path

  include_dirs = [
    "${data_service_path}/adapter/include/communicator",
    "${data_service_path}/framework/include",
    "${data_service_path}/service/kvdb",
    "${data_service_path}/service/permission/include",
    "${data_service_path}/service/test/mock",
  ]

  sources = [
    "${data_service_path}/service/kvdb/user_delegate.cpp",
    "${data_service_path}/service/permission/src/permission_validator.cpp",
    "${data_service_path}/service/permission/src/permit_delegate.cpp",
    "mock/access_token_mock.cpp",
    "mock/meta_data_manager_mock.cpp",
    "permit_delegate_mock_test.cpp",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  cflags_cc = cflags
  defines = [
    "TEST_ON_DEVICE",
    "OPENSSL_SUPPRESS_DEPRECATED",
  ]

  deps = [
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/adapter/utils:distributeddata_utils",
    "${data_service_path}/framework:distributeddatasvcfwk",
  ]

  external_deps = [
    "access_token:libaccesstoken_sdk",
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gmock_main",
    "googletest:gtest_main",
    "hilog:libhilog",
    "json:nlohmann_json_static",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddb",
  ]
}

ohos_unittest("BootStrapMockTest") {
  sanitize = {
    cfi = true
    cfi_cross_dso = true
    debug = false
  }

  include_dirs = [
    "${data_service_path}/service/backup/include",
    "${data_service_path}/service/bootstrap/include/",
    "${data_service_path}/service/config/include/",
    "${data_service_path}/service/config/include/model",
  ]

  module_out_path = module_output_path
  sources = [
    "${data_service_path}/service/bootstrap/src/bootstrap.cpp",
    "${data_service_path}/service/config/src/model/app_access_check_config.cpp",
    "${data_service_path}/service/config/src/model/app_id_mapping_config.cpp",
    "${data_service_path}/service/config/src/model/backup_config.cpp",
    "${data_service_path}/service/config/src/model/checker_config.cpp",
    "${data_service_path}/service/config/src/model/cloud_config.cpp",
    "${data_service_path}/service/config/src/model/component_config.cpp",
    "${data_service_path}/service/config/src/model/datashare_config.cpp",
    "${data_service_path}/service/config/src/model/device_sync_app_white_list_config.cpp",
    "${data_service_path}/service/config/src/model/directory_config.cpp",
    "${data_service_path}/service/config/src/model/global_config.cpp",
    "${data_service_path}/service/config/src/model/network_config.cpp",
    "${data_service_path}/service/config/src/model/protocol_config.cpp",
    "${data_service_path}/service/config/src/model/thread_config.cpp",
    "bootstrap_mock_test.cpp",
    "mock/config_factory_mock.cpp",
  ]

  external_deps = [
    "bundle_framework:appexecfwk_core",
    "googletest:gtest_main",
    "hilog:libhilog",
    "kv_store:distributeddata_inner",
  ]

  deps = [
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service/backup:distributeddata_backup",
  ]

  cflags = [
    "-Werror",
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  cflags_cc = cflags

  defines = [
    "TEST_ON_DEVICE",
    "OPENSSL_SUPPRESS_DEPRECATED",
  ]
}

ohos_unittest("QueryHelperUnitTest") {
  module_out_path = module_output_path

  include_dirs = [
    "${data_service_path}/adapter/include/communicator",
    "${data_service_path}/adapter/include/utils",
    "${data_service_path}/service/kvdb",
  ]

  sources = [
    "${data_service_path}/service/kvdb/query_helper.cpp",
    "query_helper_test.cpp",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  deps = [
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/adapter/utils:distributeddata_utils",
    "${data_service_path}/framework:distributeddatasvcfwk",
  ]

  external_deps = [
    "access_token:libaccesstoken_sdk",
    "access_token:libtokenid_sdk",
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gtest_main",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "ipc:ipc_core",
    "json:nlohmann_json_static",
    "kv_store:datamgr_common",
    "kv_store:distributeddb",
    "kv_store:kvdb_inner_lite",
  ]
}

ohos_unittest("AuthDelegateMockTest") {
  module_out_path = module_output_path

  include_dirs = [
    "${data_service_path}/adapter/include/communicator/",
    "${data_service_path}/framework/include/",
    "${data_service_path}/service/kvdb/",
    "${data_service_path}/service/test/mock",
  ]

  sources = [
    "${data_service_path}/service/kvdb/auth_delegate.cpp",
    "auth_delegate_mock_test.cpp",
    "mock/device_manager_adapter_mock.cpp",
    "mock/user_delegate_mock.cpp",
  ]

  external_deps = [
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gmock_main",
    "googletest:gtest_main",
    "hilog:libhilog",
    "json:nlohmann_json_static",
    "kv_store:distributeddata_inner",
  ]

  deps = [
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service:distributeddatasvc",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  cflags_cc = cflags

  defines = [
    "TEST_ON_DEVICE",
    "OPENSSL_SUPPRESS_DEPRECATED",
  ]
}

ohos_unittest("UpgradeMockTest") {
  module_out_path = module_output_path

  include_dirs = [
    "${data_service_path}/adapter/include/communicator/",
    "${data_service_path}/framework/include/",
    "${data_service_path}/service/bootstrap/include/",
    "${data_service_path}/service/crypto/include/",
    "${data_service_path}/service/kvdb/",
    "${data_service_path}/service/matrix/include/",
    "${data_service_path}/service/rdb/",
    "${data_service_path}/service/test/mock",
  ]

  sources = [
    "${data_service_path}/service/kvdb/kvdb_general_store.cpp",
    "${data_service_path}/service/kvdb/upgrade.cpp",
    "mock/access_token_mock.cpp",
    "upgrade_mock_test.cpp",
  ]

  external_deps = [
    "access_token:libaccesstoken_sdk",
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gmock_main",
    "googletest:gtest_main",
    "hilog:libhilog",
    "huks:libhukssdk",
    "json:nlohmann_json_static",
    "kv_store:datamgr_common",
    "kv_store:distributeddb",
  ]

  deps = [
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/adapter/utils:distributeddata_utils",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service/bootstrap:distributeddata_bootstrap",
    "${data_service_path}/service/crypto:distributeddata_crypto",
    "${data_service_path}/service/matrix:distributeddata_matrix",
    "${data_service_path}/service/rdb:distributeddata_rdb",
    "${data_service_path}/service/test/mock:distributeddata_mock_static",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  cflags_cc = cflags
}

ohos_unittest("UserDelegateMockTest") {
  module_out_path = module_output_path

  include_dirs = [
    "${data_service_path}/adapter/include/communicator/",
    "${data_service_path}/framework/include/",
    "${data_service_path}/service/kvdb/",
    "${data_service_path}/service/test/mock",
  ]

  sources = [
    "${data_service_path}/service/kvdb/user_delegate.cpp",
    "mock/account_delegate_mock.cpp",
    "mock/device_manager_adapter_mock.cpp",
    "user_delegate_mock_test.cpp",
  ]

  external_deps = [
    "access_token:libaccesstoken_sdk",
    "c_utils:utils",
    "device_manager:devicemanagersdk",
    "googletest:gmock_main",
    "googletest:gtest_main",
    "hilog:libhilog",
    "json:nlohmann_json_static",
    "kv_store:datamgr_common",
    "kv_store:distributeddb",
  ]

  deps = [ "${data_service_path}/framework:distributeddatasvcfwk" ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  cflags_cc = cflags
}

ohos_unittest("BackupManagerServiceTest") {
  sanitize = {
    cfi = true
    cfi_cross_dso = true
    debug = false
  }
  module_out_path = module_output_path
  sources = [
    "${data_service_path}/app/src/kvstore_meta_manager.cpp",
    "backup_manager_service_test.cpp",
  ]

  include_dirs = [
    "${data_service_path}/adapter/include/communicator",
    "${data_service_path}/app/src",
    "${data_service_path}/service/bootstrap/include/",
    "${data_service_path}/service/common",
    "${data_service_path}/service/crypto/include",
    "${data_service_path}/service/matrix/include/",
    "${data_service_path}/service/rdb",
    "${data_service_path}/service/kvdb",
    "${data_service_path}/service/backup/include/",
  ]

  cflags = [
    "-Dprivate=public",
    "-Dprotected=public",
  ]

  external_deps = [
    "ability_base:base",
    "ability_base:want",
    "access_token:libaccesstoken_sdk",
    "access_token:libnativetoken",
    "c_utils:utils",
    "dataclassification:data_transit_mgr",
    "device_manager:devicemanagersdk",
    "googletest:gtest_main",
    "hilog:libhilog",
    "hisysevent:libhisysevent",
    "ipc:ipc_core",
    "kv_store:distributeddata_inner",
    "kv_store:distributeddata_mgr",
    "kv_store:distributeddb",
  ]

  deps = [
    "${data_service_path}/adapter/account:distributeddata_account",
    "${data_service_path}/adapter/communicator:distributeddata_communicator",
    "${data_service_path}/framework:distributeddatasvcfwk",
    "${data_service_path}/service/backup:distributeddata_backup",
    "${data_service_path}/service/kvdb:distributeddata_kvdb",
  ]
}

###############################################################################
group("unittest") {
  testonly = true

  deps = []

  if (datamgr_service_config) {
    deps += [ ":ConfigFactoryTest" ]
  }

  if (datamgr_service_cloud) {
    deps += [
      ":CloudDataTest",
      ":CloudServiceImplTest",
      ":CloudTest",
      "ohos_test:copy_ohos_test",
      "testCloud:testCloud",
    ]
  }

  if (datamgr_service_udmf) {
    deps += [
      ":UdmfCheckerManagerTest",
      ":UdmfPreProcessUtilsMockTest",
      ":UdmfPreProcessUtilsTest",
      ":UdmfRunTimeStoreTest",
      ":UdmfServiceImplTest",
      ":UdmfServiceStubMockTest",
      ":UdmfServiceStubTest",
    ]
  }

  if (datamgr_service_object) {
    deps += [
      ":ObjectAssetLoaderTest",
      ":ObjectAssetMachineTest",
      ":ObjectDmsHandlerTest",
      ":ObjectManagerTest",
      ":ObjectSnapshotTest",
    ]
  }

  if (datamgr_service_rdb) {
    deps += [
      ":RdbResultSetImplTest",
      ":RdbServiceImplTest",
      ":RdbServiceTest",
    ]
  }

  if (datamgr_service_kvdb) {
    deps += [
      ":AuthDelegateMockTest",
      ":BackupManagerServiceTest",
      ":KVDBGeneralStoreAbnormalTest",
      ":KVDBGeneralStoreTest",
      ":KvdbServiceImplTest",
      ":QueryHelperUnitTest",
      ":UpgradeMockTest",
      ":UserDelegateMockTest",
    ]
  }

  if (datamgr_service_data_share) {
    deps += [ ":DataShareServiceImplTest" ]
  }

  deps += [
    ":BootStrapMockTest",
    ":CryptoManagerTest",
    ":DeviceMatrixTest",
    ":DirectoryManagerTest",
    ":DumpHelperTest",
    ":MetaDataTest",
    ":PermissionValidatorMockTest",
    ":PermissionValidatorTest",
    ":PermitDelegateMockTest",
    ":ValueProxyServiceTest",
  ]
}
###############################################################################
